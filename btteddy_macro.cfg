[gcode_macro BED_MESH_CALIBRATE]
rename_existing: _BED_MESH_CALIBRATE
variable_scan_type: 'rapid_scan'
variable_accel: 1000
gcode:
    RESPOND TYPE=command MSG='Call custom BED_MESH_CALIBRATE'
    {% set max_accel = printer.configfile.settings['printer'].max_accel %}
    SET_VELOCITY_LIMIT ACCEL={accel}

    BED_MESH_CLEAR
    G4 P500 # wait required to prevent MCU overload / inconsistant meshing

    _BED_MESH_CALIBRATE METHOD={scan_type} {rawparams}
    
    RESPOND TYPE=command MSG='Restoring ACCEL={max_accel}'
    SET_VELOCITY_LIMIT ACCEL={max_accel}